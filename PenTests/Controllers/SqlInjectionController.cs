using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Web;
using System.Web.Configuration;
using System.Web.Mvc;

namespace PenTests.Controllers
{
    public class SqlInjectionController : Controller
    {

        // GET: SqlInjection
        public ActionResult Index()
        {
            var catID = Request.QueryString["CategoryID"];
            if (!String.IsNullOrWhiteSpace(catID))
            {
                var sqlString = "SELECT * FROM Products WHERE CategoryID = " + catID;
                var connString = WebConfigurationManager.ConnectionStrings["PentestConnection"].ConnectionString;
                using (var conn = new SqlConnection(connString))
                {
                    var command = new SqlCommand(sqlString, conn); command.Connection.Open();
                    var results = command.ExecuteReader();
                    //grdProducts.DataBind();
                }
            }
            return View();
        }


        // GET: SqlInjection - slightly improved
        public ActionResult ParameterisedIndex(int catID)
        {
            const string sqlString = "SELECT * FROM Products WHERE CategoryID = @CategoryID";
            var connString = WebConfigurationManager.ConnectionStrings["NorthwindConnectionString"].ConnectionString;
            using (var conn = new SqlConnection(connString))
            {
                var command = new SqlCommand(sqlString, conn);
                command.Parameters.Add("@CategoryID", SqlDbType.Int).Value = catID;
                command.Connection.Open();
                var results = command.ExecuteReader();
                //grdProducts.DataBind();

            }
                return View();
        }

        // GET: SqlInjection - slightly improved
        public ActionResult ORMIndex(int catID)
        {
            //var dc = new NorthwindDataContext(); 
           // var catIDInt = Convert.ToInt16(catID); 
            //var results = dc.Products.Where(p => p.CategoryID == catIDInt);
            return View();
        }
    }
}